<!doctype html>
<html lang="en" ng-app="application">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tamu Registration</title>
    <link href="./assets/css/app.css" rel="stylesheet" type="text/css">
    <script src="./assets/js/foundation.js"></script>
    <script src="./assets/js/templates.js"></script>
    <script src="./assets/js/routes.js"></script>
    <script src="./assets/js/app.js"></script>
    <script src="./assets/schedule/dhtmlxscheduler.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" href="./assets/schedule/dhtmlxscheduler.css" type="text/css" media="screen" title="no title" charset="utf-8">

    <style type="text/css" media="screen">
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }

        .dhx_cal_event div.dhx_footer,
        .dhx_cal_event.past_event div.dhx_footer,
        .dhx_cal_event.event_english div.dhx_footer,
        .dhx_cal_event.event_math div.dhx_footer,
        .dhx_cal_event.event_science div.dhx_footer {
            background-color: transparent !important;
        }

        .dhx_cal_event .dhx_body {
            -webkit-transition: opacity 0.1s;
            transition: opacity 0.1s;
            opacity: 0.7;
        }

        .dhx_cal_event .dhx_title {
            line-height: 12px;
        }

        .dhx_cal_event_line:hover,
        .dhx_cal_event:hover .dhx_body,
        .dhx_cal_event.selected .dhx_body,
        .dhx_cal_event.dhx_cal_select_menu .dhx_body {
            opacity: 1;
        }

        .dhx_cal_event.event_math div, .dhx_cal_event_line.event_math {
            background-color: orange !important;
            border-color: #a36800 !important;
        }

        .dhx_cal_event_clear.event_math {
            color: orange !important;
        }

        .dhx_cal_event.event_science div, .dhx_cal_event_line.event_science {
            background-color: #36BD14 !important;
            border-color: #698490 !important;
        }

        .dhx_cal_event_clear.event_science {
            color: #36BD14 !important;
        }

        .dhx_cal_event.event_english div, .dhx_cal_event_line.event_english {
            background-color: #FC5BD5 !important;
            border-color: #839595 !important;
        }

        .dhx_cal_event_clear.event_english {
            color: #B82594 !important;
        }

        .dhx_cal_event.event_CSCE div, .dhx_cal_event_line.event_CSCE {
            background-color: green !important;
            border-color: #698490 !important;
        }

        .dhx_cal_event_clear.event_CSCE {
            color: green !important;
        }
    </style>

    <script type="text/javascript" charset="utf-8">
        function init() {
          console.log("DSSDSDS");
            scheduler.config.xml_date = "%Y-%m-%d %h:%i";
            scheduler.config.time_step = 30;
            scheduler.config.multi_day = false;
            scheduler.locale.labels.section_subject = "Subject";
            scheduler.config.first_hour = 6;
            scheduler.config.limit_time_select = true;
            scheduler.config.details_on_dblclick = true;
            scheduler.config.details_on_create = true;
            scheduler.config.readonly = true;
            scheduler.config.hour_scale = 12;
            scheduler.config.hour_date = "%h:%i %A";

            scheduler.templates.event_class = function (start, end, event) {
                var css = "";

                if (event.subject) // if event has subject property then special class should be assigned
                    css += "event_" + event.subject;

                if (event.id == scheduler.getState().select_id) {
                    css += " selected";
                }
                return css; // default return

                /*
                 Note that it is possible to create more complex checks
                 events with the same properties could have different CSS classes depending on the current view:

                 var mode = scheduler.getState().mode;
                 if(mode == "day"){
                 // custom logic here
                 }
                 else {
                 // custom logic here
                 }
                 */
            };

            var subject = [
                {key: '', label: 'Appointment'},
                {key: 'english', label: 'English'},
                {key: 'math', label: 'Math'},
                {key: 'science', label: 'Science'},
                {key: 'CSCE', label: 'CSCE'}
            ];

            scheduler.config.lightbox.sections = [
                {name: "description", height: 43, map_to: "text", type: "textarea", focus: true},
                {name: "subject", height: 20, type: "select", options: subject, map_to: "subject"},
                {name: "time", height: 72, type: "time", map_to: "auto"}
            ];

            scheduler.init('scheduler_here', new Date(2016, 0, 19), "week");

            $.getJSON("../app/database/scheduled.json", function (data) {
                var info = data;
                console.log(info);
                console.log("First course: " + info.courses[0][0].meeting_times[0].professor);

                var schedule = [];
                for(var x = 0; x < info.courses[0].length; x++) {
                    for (var i = 0; i < info.courses[0][x].meeting_times.length; i++) {
                        var meeting_times = info.courses[0][x].meeting_times[i];
                        console.log(info.courses[0][x].meeting_times[i].time);
                        //Get start date
                        var date_range = meeting_times.date_range.split("-");
                        var date = new Date(date_range[0]);
                        if(meeting_times.days == "MW" || meeting_times.days == "MWF"){
                            date.setDate(date.getDate()+1);
                        }
                        var start_date = date.getFullYear() + "-" + parseInt(date.getMonth() + 1) + "-" + date.getDate();
//                  date = new Date(date_range[1]);

                        var end_date = start_date;
                        date = new Date(date_range[1]);
                        var last_day = date.getFullYear() + "-" + parseInt(date.getMonth() + 1) + "-" + date.getDate();
                        console.log(last_day);
                        var times = meeting_times.time.split("-");
                        var start_time;
                        var end_time;
                        console.log(String(times[0]));
                        if (String(times[0]).match("pm")) {
                            var hour = String(times[0]).replace("pm", "");
                            hour.replace(" ", "");
                            start_time = hour.split(":");

                            start_time = parseInt(start_time[0]) + 12 + ":" + start_time[1];

                            start_date += " " + start_time;
                            console.log(start_date);
                        }
                        else {
                            var hour = String(times[0]).replace("pm", "");
                            hour.replace(" ", "");
                            var start_time = hour.split(":");

                            start_time = parseInt(start_time[0]) + ":" + start_time[1];

                            start_date += " " + start_time;
                            console.log(start_date);
                        }

                        //Get end time
                        if (String(times[1]).match("pm")) {
                            var hour = String(times[1]).replace("pm", "");
                            hour.replace(" ", "");
                            var end_time = hour.split(":");

                            end_time = parseInt(end_time[0]) + 12 + ":" + end_time[1];

                            end_date += " " + end_time;
                            console.log(end_date);
                        }
                        else {
                            var hour = String(times[1]).replace("pm", "");
                            hour.replace(" ", "");
                            end_time = hour.split(":");

                            end_time = parseInt(end_time[0]) + ":" + end_time[1];

                            end_date += " " + end_time;
                            console.log(end_date);
                        }

                        var obj = {};

                        obj['start_date'] = start_date;
                        obj['end_date'] = end_date;
                        obj['text'] = info.courses[0][x].CID + " - " + meeting_times.type;
                        obj['subject'] = info.courses[0][x].subject;
                        console.log(obj);
                        schedule.push(obj);
                        var recurringDate = new Date(start_date);
                        while(new Date(recurringDate) < new Date(last_day)){
                            console.log("Recurring date: " + recurringDate);
                            console.log("Last date: " + last_day);
                            var new_new_obj = {};
                            recurringDate.setDate(recurringDate.getDate()+7);
                            recurringDate = recurringDate.getFullYear() + "-" + parseInt(recurringDate.getMonth() + 1) + "-" + parseInt(recurringDate.getDate());
                            console.log("Recurring date: " + recurringDate);
                            start_date = recurringDate;
                            start_date += " " + start_time;
                            end_date = recurringDate;
                            end_date += " " + end_time;

                            new_new_obj['start_date'] = start_date;
                            new_new_obj['end_date'] = end_date;
                            new_new_obj['text'] = info.courses[0][x].CID + " - " + meeting_times.type;
                            new_new_obj['subject'] = info.courses[0][x].subject;
                            recurringDate = new Date(recurringDate);
//                            console.log(new_new_obj);
                            if(new Date(recurringDate) <= new Date(last_day)) {
                                schedule.push(new_new_obj);
                            }
                        }

                        if(meeting_times.days == "TR" || meeting_times.days == "MWF") {
                            var new_obj = {};
                            var date = new Date(date_range[0]);
                            if(meeting_times.days == "MW" || meeting_times.days == "MWF"){
                                date.setDate(date.getDate()+1);
                            }
                            console.log("Date: " + date);
                            start_date = date.getFullYear() + "-" + parseInt(date.getMonth() + 1) + "-" + parseInt(date.getDate()+2);
                            end_date = start_date + " " + end_time;
                            start_date += " " + start_time;

                            new_obj['start_date'] = start_date;
                            new_obj['end_date'] = end_date;
                            new_obj['text'] = info.courses[0][x].CID + " - " + meeting_times.type;
                            new_obj['subject'] = info.courses[0][x].subject;
                            console.log(new_obj);
                            schedule.push(new_obj);

                            console.log(new Date(last_day));


                        }
                        recurringDate = new Date(start_date);

                        while(new Date(recurringDate) < new Date(last_day)){
                            console.log("Recurring date: " + recurringDate);
                            console.log("Last date: " + last_day);
                            var new_new_obj = {};
                            recurringDate.setDate(recurringDate.getDate()+7);
                            recurringDate = recurringDate.getFullYear() + "-" + parseInt(recurringDate.getMonth() + 1) + "-" + parseInt(recurringDate.getDate());
                            console.log("Recurring date: " + recurringDate);
                            start_date = recurringDate;
                            start_date += " " + start_time;
                            end_date = recurringDate;
                            end_date += " " + end_time;

                            new_new_obj['start_date'] = start_date;
                            new_new_obj['end_date'] = end_date;
                            new_new_obj['text'] = info.courses[0][x].CID + " - " + meeting_times.type;
                            new_new_obj['subject'] = info.courses[0][x].subject;
                            recurringDate = new Date(recurringDate);
//                            console.log(new_new_obj);
                            if(new Date(recurringDate) <= new Date(last_day)) {
                                schedule.push(new_new_obj);
                            }
                        }

                        if(meeting_times.days == "MW" || meeting_times.days == "MWF") {
                            var new_obj = {};
                            var date = new Date(date_range[0]);

                            date = new Date('january 25, 2016 03:24:00');

                            console.log("Date: " + date);
                            start_date = date.getFullYear() + "-" + parseInt(date.getMonth() + 1) + "-" + parseInt(date.getDate());
                            end_date = start_date + " " + end_time;
                            start_date += " " + start_time;

                            new_obj['start_date'] = start_date;
                            new_obj['end_date'] = end_date;
                            new_obj['text'] = info.courses[0][x].CID + " - " + meeting_times.type;
                            new_obj['subject'] = info.courses[0][x].subject;
                            console.log(new_obj);
                            schedule.push(new_obj);

                            console.log(new Date(last_day));


                        }
                        recurringDate = new Date(start_date);

                        while(new Date(recurringDate) < new Date(last_day)){
                            console.log("Recurring date: " + recurringDate);
                            console.log("Last date: " + last_day);
                            var new_new_obj = {};
                            recurringDate.setDate(recurringDate.getDate()+7);
                            recurringDate = recurringDate.getFullYear() + "-" + parseInt(recurringDate.getMonth() + 1) + "-" + parseInt(recurringDate.getDate());
                            console.log("Recurring date: " + recurringDate);
                            start_date = recurringDate;
                            start_date += " " + start_time;
                            end_date = recurringDate;
                            end_date += " " + end_time;

                            new_new_obj['start_date'] = start_date;
                            new_new_obj['end_date'] = end_date;
                            new_new_obj['text'] = info.courses[0][x].CID + " - " + meeting_times.type;
                            new_new_obj['subject'] = info.courses[0][x].subject;
                            recurringDate = new Date(recurringDate);
//                            console.log(new_new_obj);
                            if(new Date(recurringDate) <= new Date(last_day)) {
                                schedule.push(new_new_obj);
                            }
                        }
                        console.log("Recurring date: " + recurringDate);
                        console.log("Last date: " + last_day);
                    }

                }
                scheduler.parse(schedule, "json");
//                scheduler.parse([
//                    {
//                        start_date: "2016-01-19 3:55 pm",
//                        end_date: "2016-01-19 5:55 pm",
//                        text: "English blessin",
//                        subject: 'CSCE'
//                    },
//                    {start_date: "2015-04-21 10:00", end_date: "2015-04-21 16:00", text: "Math bokay", subject: 'math'},
//                    {
//                        start_date: "2015-04-21 10:00",
//                        end_date: "2015-04-21 14:00",
//                        text: "Science lesson",
//                        subject: 'science'
//                    },
//                    {
//                        start_date: "2015-04-23 16:00",
//                        end_date: "2015-04-23 17:00",
//                        text: "English lesson",
//                        subject: 'english'
//                    },
//                    {start_date: "2015-04-24 09:00", end_date: "2015-04-24 17:00", text: "Usual event"}
//                ], "json");
            });


        }
    </script>
  </head>
  <body>
    <div class="grid-frame vertical">
      <div class="grid-content shrink" style="padding: 0;">
        <ul class="primary condense menu-bar">
          <li><a><strong>Degree Plan</strong></a></li>
          <li><a ui-sref="upper"><strong>Upper</strong></a></li>
          <li><a ui-sref="schedule"><strong>Schedule</strong></a></li>
        </ul>
      </div>
      <div ui-view class="grid-content">
      </div>
    </div>
  </body>
</html>
